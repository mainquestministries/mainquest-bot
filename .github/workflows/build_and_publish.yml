name: Node.js Package and Release

on:
  push:
    tags:
      - "*"

jobs:
  main:
   runs-on: ubuntu-latest
   steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-node@v3
      with:
        node-version: 18
    - name: Install Clean
      run: npm ci
    - name: Build
      run: npm run build:production
    - name: Bundle
      run: zip -r ${{ github.event.repository.name }}-release-${{github.ref_name}}.zip . -x "*.csv" "share/*" "scripts/*" "dist/.tsbuildinfo" "node_modules/*" "typings/*" "src/*" ".git/*" ".github/*" "node_modules/*" ".gitignore" "**/*.js.map" "tsconfig.json"
    - name: Publish
      uses: softprops/action-gh-release@v1
      if: startsWith(github.ref, 'refs/tags/')
      with:
        name: Release ${{ github.ref_name}}
        prerelease: ${{ env.is_prerelease }}
        files:  ${{ github.event.repository.name }}-release-${{github.ref_name}}.zip
        generate_release_notes: true
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
